<html>
<head>
<title>
	SOCPrint! - Printing made simplier
</title>
<link rel="stylesheet" href="style.css">	
<script type="text/javascript">
var isLoggingIn = false;

function checkServer() 
{
	var xmlhttp = new XMLHttpRequest();
	if (xmlhttp==null)
	{
		document.getElementById("serverStatus").innerHTML = "XMLHttpRequest not supported. Status unknown.";
		return;
	}
        xmlhttp.onreadystatechange = function() 
		{
            if (xmlhttp.readyState == 4) 
			{
                document.getElementById("serverStatus").innerHTML = xmlhttp.responseText;
            }
        }
	xmlhttp.open("GET", "isOnline.php", true);
	xmlhttp.send();
	
    
}
function sendCommand()
{
	var xmlhttp = new XMLHttpRequest();
	xmlhttp.open("POST", "SendCommand.php", true);
	xmlhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
	xmlhttp.send("name=" + document.getElementById("username").value + "&password=" + document.getElementById("password").value);
	
	xmlhttp.onreadystatechange = function() 
	{
		if (xmlhttp.readyState == 4) 
		{
			document.getElementById("printerStatus").innerHTML = xmlhttp.responseText;
		}
	}

	xmlhttp.send();
}
function checkLogin()
{
	var loginMSG =	 document.getElementById("loginMSG");
	
	if(isLoggingIn)
	{	
		return;		
	}
	
	if(document.getElementById("login").innerHTML == "Login")
	{
		if(document.getElementById("username").value == "")
		{
			loginMSG.style.color = "red";
			loginMSG.innerHTML = "Please enter your username";	
			return;
		}
		if(document.getElementById("password").value == "")
		{
			loginMSG.style.color = "red";
			loginMSG.innerHTML = "Please enter your password";			
			return;
		}
		var xmlhttp = new XMLHttpRequest();
		xmlhttp.open("POST", "checklogin.php", true);
		xmlhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
		
		xmlhttp.onreadystatechange = function() 
		{
			if (xmlhttp.readyState == 4) 
			{
				if(xmlhttp.responseText == "OK")
				{
					document.getElementById("login").innerHTML = "Disconnect";
					loginMSG.style.color = "lime";
					loginMSG.innerHTML = "Logged in successfully";
					document.getElementById("username").disabled = true;
					document.getElementById("password").disabled = true;
					sendCommand();
				}
				else if(xmlhttp.responseText == "WRONG")
				{
					loginMSG.style.color = "red";
					loginMSG.innerHTML = "Incorrect username or password";
				}
				else if(xmlhttp.responseText == "NO_CONNECTION")
				{
					loginMSG.style.color = "red";
					loginMSG.innerHTML = "Unable to connect to sunfire";
				}
				else
				{
					loginMSG.style.color = "red";
					loginMSG.innerHTML = "Unknown: " + xmlhttp.responseText;
				}
			}
			isLoggingIn = false;
		}
		isLoggingIn = true;		
		loginMSG.style.color = "orange";
		loginMSG.innerHTML = "Logging In Now";
		xmlhttp.send("name=" + document.getElementById("username").value + "&password=" + document.getElementById("password").value);
	}
	else
	{
		document.getElementById("login").innerHTML = "Login";
		document.getElementById("username").value = "";
		document.getElementById("password").value = "";
		
		loginMSG.style.color = "lime";
		loginMSG.innerHTML = "Disconnected in successfully";
		document.getElementById("username").disabled = false;
		document.getElementById("password").disabled = false;
	}
}
</script>
</head>
<body onload="checkServer()">

<header>
<img src="img/logo_big.png" alt="SOCPrint!" style="width:8em;height:2em; float:left">
<p id="serverStatus">	
Server status: Checking
</p>
</header>
<div class="content">
<div class="center">
<table>
	<tr>
		<td>
		<div id="loginMSG"><br>	</div>
		</td>
	</tr>
	<tr>
		<td>
		<input id="username" class="textbox" type="text" name="name" placeholder="Sunfire ID e.g. a0123456 or tantc"><br>
		<input id="password" class="textbox" type="password" name="password" placeholder="Password"><br>
		
		</td>

		<td>
		<a onclick="checkLogin()" class="loginBtn" type="button" id="login">Login</a>
		</td>
	</tr>
</table>
<table>
	<br>
	<tr>
		<td>
			<table>
				<tr width="100%" align="center">
				Printer Selection
				</tr>
				<tr>
				<td><input type="radio" name="printer" value="psts">psts</td>
				<td><input type="radio" name="printer" value="psts">pstsb</td>
				<td><input type="radio" name="printer" value="psts">pstsc</td>
				</tr>
			</table>
			File: <input type="file" name="file"><br>
		<!-- <input type="submit"> !-->
		<td>
	</tr>
	<tr>
		<td>
		<div id="printerStatus"></div>
		</td>
	</tr>
</table>
</div>
</div>
</body>
</html>